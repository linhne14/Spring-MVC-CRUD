<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keycloak Setup Guide</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .code-block {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            margin: 1rem 0;
        }
        .step {
            border-left: 4px solid #0d6efd;
            padding-left: 1rem;
            margin: 1.5rem 0;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h2><i class="fas fa-cog"></i> H∆∞·ªõng d·∫´n Setup Keycloak</h2>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-warning">
                            <strong>L∆∞u √Ω:</strong> Hi·ªán t·∫°i ·ª©ng d·ª•ng ch·∫°y ·ªü ch·∫ø ƒë·ªô demo kh√¥ng c√≥ OAuth2. 
                            ƒê·ªÉ s·ª≠ d·ª•ng ƒë·∫ßy ƒë·ªß t√≠nh nƒÉng SSO, vui l√≤ng l√†m theo c√°c b∆∞·ªõc d∆∞·ªõi ƒë√¢y.
                        </div>

                        <!-- Step 1 -->
                        <div class="step">
                            <h4>üê≥ B∆∞·ªõc 1: Kh·ªüi ƒë·ªông Keycloak v·ªõi Docker</h4>
                            <p>M·ªü Command Prompt/PowerShell v√† ch·∫°y l·ªánh sau:</p>
                            <div class="code-block">
docker run -d --name keycloak-sso -p 8081:8080 \<br>
&nbsp;&nbsp;-e KEYCLOAK_ADMIN=admin \<br>
&nbsp;&nbsp;-e KEYCLOAK_ADMIN_PASSWORD=admin \<br>
&nbsp;&nbsp;quay.io/keycloak/keycloak:latest start-dev
                            </div>
                            <p><strong>Ho·∫∑c n·∫øu kh√¥ng c√≥ Docker:</strong> T·∫£i Keycloak t·ª´ <a href="https://www.keycloak.org/downloads" target="_blank">keycloak.org</a></p>
                        </div>

                        <!-- Step 2 -->
                        <div class="step">
                            <h4>‚öôÔ∏è B∆∞·ªõc 2: Truy c·∫≠p Keycloak Admin Console</h4>
                            <p>Sau khi Keycloak kh·ªüi ƒë·ªông (kho·∫£ng 1-2 ph√∫t):</p>
                            <ul>
                                <li>M·ªü browser v√† v√†o: <a href="http://localhost:8081/admin" target="_blank">http://localhost:8081/admin</a></li>
                                <li>Username: <code>admin</code></li>
                                <li>Password: <code>admin</code></li>
                            </ul>
                        </div>

                        <!-- Step 3 -->
                        <div class="step">
                            <h4>üè¢ B∆∞·ªõc 3: T·∫°o Realm</h4>
                            <ol>
                                <li>Click dropdown <strong>"Master"</strong> g√≥c tr√°i tr√™n</li>
                                <li>Click <strong>"Create Realm"</strong></li>
                                <li>Realm name: <code>spring-boot-sso</code></li>
                                <li>Click <strong>"Create"</strong></li>
                            </ol>
                        </div>

                        <!-- Step 4 -->
                        <div class="step">
                            <h4>üì± B∆∞·ªõc 4: T·∫°o OAuth2 Client</h4>
                            <ol>
                                <li>V√†o <strong>"Clients"</strong> ‚Üí <strong>"Create client"</strong></li>
                                <li>Client ID: <code>spring-boot-client</code></li>
                                <li>Client authentication: <strong>ON</strong></li>
                                <li>Valid redirect URIs: <code>http://localhost:8080/login/oauth2/code/keycloak</code></li>
                                <li>Web origins: <code>http://localhost:8080</code></li>
                                <li>Click <strong>"Save"</strong></li>
                                <li><strong>Quan tr·ªçng:</strong> Copy <strong>Client Secret</strong> t·ª´ tab "Credentials"</li>
                            </ol>
                        </div>

                        <!-- Step 5 -->
                        <div class="step">
                            <h4>üë§ B∆∞·ªõc 5: T·∫°o User Test</h4>
                            <ol>
                                <li>V√†o <strong>"Users"</strong> ‚Üí <strong>"Create new user"</strong></li>
                                <li>Username: <code>testuser</code></li>
                                <li>Email: <code>test@example.com</code></li>
                                <li>First name: <code>Test</code>, Last name: <code>User</code></li>
                                <li>Click <strong>"Create"</strong></li>
                                <li>V√†o tab <strong>"Credentials"</strong> ‚Üí Set password: <code>password123</code></li>
                                <li>T·∫Øt <strong>"Temporary"</strong> ‚Üí Click <strong>"Set password"</strong></li>
                            </ol>
                        </div>

                        <!-- Step 6 -->
                        <div class="step">
                            <h4>üîß B∆∞·ªõc 6: C·∫•u h√¨nh Application</h4>
                            <p>M·ªü file <code>application.properties</code> v√† uncomment c√°c d√≤ng sau, thay th·∫ø gi√° tr·ªã:</p>
                            <div class="code-block">
spring.security.oauth2.client.registration.keycloak.client-id=spring-boot-client<br>
spring.security.oauth2.client.registration.keycloak.client-secret=<strong>[YOUR_CLIENT_SECRET]</strong><br>
spring.security.oauth2.client.registration.keycloak.authorization-grant-type=authorization_code<br>
spring.security.oauth2.client.registration.keycloak.redirect-uri=http://localhost:8080/login/oauth2/code/keycloak<br>
spring.security.oauth2.client.registration.keycloak.scope=openid,profile,email<br><br>

spring.security.oauth2.client.provider.keycloak.issuer-uri=http://localhost:8081/realms/spring-boot-sso<br>
spring.security.oauth2.resourceserver.jwt.issuer-uri=http://localhost:8081/realms/spring-boot-sso
                            </div>
                        </div>

                        <!-- Step 7 -->
                        <div class="step">
                            <h4>üöÄ B∆∞·ªõc 7: Restart Application</h4>
                            <ol>
                                <li>Stop Spring Boot application (Ctrl+C)</li>
                                <li>Ch·∫°y l·∫°i: <code>./mvnw spring-boot:run</code></li>
                                <li>Truy c·∫≠p: <a href="http://localhost:8080">http://localhost:8080</a></li>
                                <li>Click <strong>"ƒêƒÉng nh·∫≠p v·ªõi Keycloak"</strong></li>
                            </ol>
                        </div>

                        <div class="alert alert-success mt-4">
                            <h5>‚úÖ Ho√†n th√†nh!</h5>
                            <p>Sau khi ho√†n th√†nh c√°c b∆∞·ªõc tr√™n, b·∫°n s·∫Ω c√≥ m·ªôt ·ª©ng d·ª•ng Spring Boot ho·∫°t ƒë·ªông ƒë·∫ßy ƒë·ªß v·ªõi:</p>
                            <ul class="mb-0">
                                <li>OIDC Authentication v·ªõi Keycloak</li>
                                <li>ID Token v√† Access Token</li>
                                <li>Refresh Token support</li>
                                <li>User profile management</li>
                                <li>Secure logout</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card mt-4">
                    <div class="card-header">
                        <h5>Quick Actions</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <a href="http://localhost:8081/admin" target="_blank" class="btn btn-primary w-100">
                                    <i class="fas fa-external-link-alt"></i> Keycloak Admin
                                </a>
                            </div>
                            <div class="col-md-4">
                                <a href="/" class="btn btn-secondary w-100">
                                    <i class="fas fa-home"></i> Back to Home
                                </a>
                            </div>
                            <div class="col-md-4">
                                <button class="btn btn-info w-100" onclick="checkKeycloakStatus()">
                                    <i class="fas fa-heartbeat"></i> Check Keycloak
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function checkKeycloakStatus() {
            fetch('http://localhost:8081/realms/spring-boot-sso/.well-known/openid-configuration', {
                method: 'GET',
                mode: 'no-cors'
            })
            .then(() => {
                alert('‚úÖ Keycloak ƒëang ch·∫°y! H√£y l√†m theo c√°c b∆∞·ªõc setup.');
            })
            .catch(() => {
                alert('‚ùå Keycloak ch∆∞a ch·∫°y ho·∫∑c realm ch∆∞a ƒë∆∞·ª£c t·∫°o. Vui l√≤ng l√†m theo b∆∞·ªõc 1-3.');
            });
        }
    </script>
</body>
</html>